
var data = [
    {
        "Id": 1,
    "apartmentName": "Viridian Apartments",
    "bed": 1,
    "bath": 1,
    "sqFt": 546,
    "minPrice": 1319,
    "maxPrice": 1663,
    "bullRunner": "Yes"
                },
    {
        "Id": 2,
    "apartmentName": "Viridian Apartments",
    "bed": 1,
    "bath": 1,
    "sqFt": 816,
    "minPrice": 1366,
    "maxPrice": 1894,
    "bullRunner": "Yes"
                },
    {
        "Id": 3,
    "apartmentName": "Viridian Apartments",
    "bed": 1,
    "bath": 1,
    "sqFt": 725,
    "minPrice": 1426,
    "maxPrice": 1807,
    "bullRunner": "Yes"
                },
    {
        "Id": 4,
    "apartmentName": "Viridian Apartments",
    "bed": 2,
    "bath": 2,
    "sqFt": 943,
    "minPrice": 1505,
    "maxPrice": 1741,
    "bullRunner": "Yes"
                },
    {
        "Id": 5,
    "apartmentName": "Viridian Apartments",
    "bed": 2,
    "bath": 2,
    "sqFt": 1059,
    "minPrice": 1555,
    "maxPrice": 1841,
    "bullRunner": "Yes"
                },
    {
        "Id": 6,
    "apartmentName": "Viridian Apartments",
    "bed": 3,
    "bath": 2,
    "sqFt": 1293,
    "minPrice": 2297,
    "maxPrice": 3040,
    "bullRunner": "Yes"
                },
    {
        "Id": 7,
    "apartmentName": "Cambridge Woods",
    "bed": 1,
    "bath": 1,
    "sqFt": 580,
    "minPrice": 1289,
    "maxPrice": 1450,
    "bullRunner": "Yes"
                },
    {
        "Id": 8,
    "apartmentName": "Cambridge Woods",
    "bed": 1,
    "bath": 1,
    "sqFt": 750,
    "minPrice": 1432,
    "maxPrice": 1497,
    "bullRunner": "Yes"
                },
    {
        "Id": 9,
    "apartmentName": "Cambridge Woods",
    "bed": 1,
    "bath": 1,
    "sqFt": 650,
    "minPrice": 1880,
    "maxPrice": 1880,
    "bullRunner": "Yes"
                },
    {
        "Id": 10,
    "apartmentName": "Cambridge Woods",
    "bed": 2,
    "bath": 2.5,
    "sqFt": 1200,
    "minPrice": 1695,
    "maxPrice": 2055,
    "bullRunner": "Yes"
                },
    {
        "Id": 11,
    "apartmentName": "Cambridge Woods",
    "bed": 2,
    "bath": 2.5,
    "sqFt": 1163,
    "minPrice": 2098,
    "maxPrice": 2098,
    "bullRunner": "Yes"
                },
    {
        "Id": 12,
    "apartmentName": "Cambridge Woods",
    "bed": 2,
    "bath": 2.5,
    "sqFt": 1024,
    "minPrice": 1640,
    "maxPrice": 1780,
    "bullRunner": "Yes"
                },
    {
        "Id": 13,
    "apartmentName": "Cambridge Woods",
    "bed": 2,
    "bath": 1.5,
    "sqFt": 1309,
    "minPrice": 1675,
    "maxPrice": 1917,
    "bullRunner": "Yes"
                },
    {
        "Id": 14,
    "apartmentName": "Cambridge Woods",
    "bed": 3,
    "bath": 2.5,
    "sqFt": 1454,
    "minPrice": 2246,
    "maxPrice": 2655,
    "bullRunner": "Yes"
                },
    {
        "Id": 15,
    "apartmentName": "Cambridge Woods",
    "bed": 3,
    "bath": 2,
    "sqFt": 1525,
    "minPrice": 2197,
    "maxPrice": 2741,
    "bullRunner": "Yes"
                },
    {
        "Id": 16,
    "apartmentName": "LakeView Oaks",
    "bed": 1,
    "bath": 1,
    "sqFt": 844,
    "minPrice": 1789,
    "maxPrice": 2049,
    "bullRunner": "No"
                },
    {
        "Id": 17,
    "apartmentName": "LakeView Oaks",
    "bed": 2,
    "bath": 2,
    "sqFt": 1076,
    "minPrice": 1899,
    "maxPrice": 2169,
    "bullRunner": "No"
                },
    {
        "Id": 18,
    "apartmentName": "LakeView Oaks",
    "bed": 3,
    "bath": 3,
    "sqFt": 1354,
    "minPrice": 2399,
    "maxPrice": 2629,
    "bullRunner": "No"
                },
    {
        "Id": 19,
    "apartmentName": "Oak Ramble",
    "bed": 1,
    "bath": 1,
    "sqFt": 735,
    "minPrice": 1467,
    "maxPrice": 1557,
    "bullRunner": "Yes"
                },
    {
        "Id": 20,
    "apartmentName": "Oak Ramble",
    "bed": 1,
    "bath": 1,
    "sqFt": 820,
    "minPrice": 1536,
    "maxPrice": 1661,
    "bullRunner": "Yes"
                },
    {
        "Id": 21,
    "apartmentName": "Oak Ramble",
    "bed": 2,
    "bath": 2,
    "sqFt": 976,
    "minPrice": 1611,
    "maxPrice": 2662,
    "bullRunner": "Yes"
                }, {
        "Id": 22,
    "apartmentName": "Oak Ramble",
    "bed": 2,
    "bath": 2,
    "sqFt": 1054,
    "minPrice": 1752,
    "maxPrice": 2873,
    "bullRunner": "Yes"
                },
    {
        "Id": 23,
    "apartmentName": "Eagles Point",
    "bed": 1,
    "bath": 1,
    "sqFt": 650,
    "minPrice": 1489,
    "maxPrice": 1671,
    "bullRunner": "Yes"
                },
    {
        "Id": 24,
    "apartmentName": "Eagles Point",
    "bed": 1,
    "bath": 1,
    "sqFt": 750,
    "minPrice": 1386,
    "maxPrice": 1620,
    "bullRunner": "Yes"
                },
    {
        "Id": 25,
    "apartmentName": "Eagles Point",
    "bed": 2,
    "bath": 1,
    "sqFt": 850,
    "minPrice": 1900,
    "maxPrice": 2215,
    "bullRunner": "Yes"
                },
    {
        "Id": 26,
    "apartmentName": "Eagles Point",
    "bed": 3,
    "bath": 2,
    "sqFt": 1150,
    "minPrice": 2408,
    "maxPrice": 2867,
    "bullRunner": "Yes"
                },
    {
        "Id": 27,
    "apartmentName": "College Town",
    "bed": 1,
    "bath": 1,
    "sqFt": 838,
    "minPrice": 1500,
    "maxPrice": 1775,
    "bullRunner": "Yes"
                },
    {
        "Id": 28,
    "apartmentName": "College Town",
    "bed": 2,
    "bath": 2,
    "sqFt": 838,
    "minPrice": 950,
    "maxPrice": 1175,
    "bullRunner": "Yes"
                },
    {
        "Id": 29,
    "apartmentName": "College Town",
    "bed": 2,
    "bath": 2.5,
    "sqFt": 1210,
    "minPrice": 2100,
    "maxPrice": 2590,
    "bullRunner": "Yes"
                },
    {
        "Id": 30,
    "apartmentName": "College Town",
    "bed": 3,
    "bath": 3,
    "sqFt": 1244,
    "minPrice": 2700,
    "maxPrice": 3345,
    "bullRunner": "Yes"
                },
    {
        "Id": 31,
    "apartmentName": "College Town",
    "bed": 3,
    "bath": 3,
    "sqFt": 1054,
    "minPrice": 2550,
    "maxPrice": 3165,
    "bullRunner": "Yes"
                },
    {
        "Id": 32,
    "apartmentName": "42N Street",
    "bed": 2,
    "bath": 2,
    "sqFt": 943,
    "minPrice": 2341,
    "maxPrice": 2675,
    "bullRunner": "Yes"
                },
    {
        "Id": 33,
    "apartmentName": "42N Street",
    "bed": 3,
    "bath": 3,
    "sqFt": 1160,
    "minPrice": 2805,
    "maxPrice": 2880,
    "bullRunner": "Yes"
                },
    {
        "Id": 34,
    "apartmentName": "42N Street",
    "bed": 4,
    "bath": 4,
    "sqFt": 1440,
    "minPrice": 3600,
    "maxPrice": 3840,
    "bullRunner": "Yes"
                },
    {
        "Id": 35,
    "apartmentName": "Forest Lake",
    "bed": 2,
    "bath": 2,
    "sqFt": 1075,
    "minPrice": 2018,
    "maxPrice": 2068,
    "bullRunner": "Yes"
                },
    {
        "Id": 36,
    "apartmentName": "Forest Lake",
    "bed": 3,
    "bath": 3,
    "sqFt": 1445,
    "minPrice": 2562,
    "maxPrice": 2667,
    "bullRunner": "Yes"
                },
    {
        "Id": 37,
    "apartmentName": "Forest Lake",
    "bed": 4,
    "bath": 4,
    "sqFt": 1695,
    "minPrice": 3116,
    "maxPrice": 3196,
    "bullRunner": "Yes"
                }
    ];

    // Function to populate dropdowns
    function populateDropdowns() {
                var apartments = { };
    var beds = { };

    // Collect unique apartment names and bed numbers
    data.forEach(function (item) {
        apartments[item.apartmentName] = true;
    beds[item.bed] = true; // Use bed number as integer key
                });

    // Populate apartment dropdown
    var apartmentSelect = document.getElementById('apartmentSelect');
    for (var apartment in apartments) {
                    var option = document.createElement('option');
    option.text = apartment;
    option.value = apartment;
    apartmentSelect.add(option);
                }

    // Populate bed dropdown
    var bedSelect = document.getElementById('bedSelect');
    for (var bed in beds) {
                    var option = document.createElement('option');
    option.text = bed;
    option.value = bed;
    bedSelect.add(option);
                }
            }

    // Call function to populate dropdowns when the DOM is ready
    document.addEventListener('DOMContentLoaded', function () {
        populateDropdowns();
            });

    // Form submission handler
    document.getElementById('searchForm').addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent default form submission

    // Fetch selected values from dropdowns
    var selectedApartment = document.getElementById('apartmentSelect').value;
    var selectedBed = parseInt(document.getElementById('bedSelect').value);

    // Filter data based on selected apartment and bed
    var filteredData = data.filter(function (item) {
                    return item.apartmentName === selectedApartment && item.bed === selectedBed;
                });

    // Calculate average minPrice for the selected bed type and apartment
    var totalPrice = 0;
    var count = 0;
    filteredData.forEach(function (item) {
        totalPrice += item.minPrice;
    count++;
                });
                var averageMinPrice = count > 0 ? totalPrice / count : 0;

    // Calculate quartiles for all apartments for the selected bed type
    var prices = data.filter(function (item) {
                    return item.bed === selectedBed;
                }).map(function (item) {
                    return item.minPrice;
                }).sort(function (a, b) {
                    return a - b;
                });
    var q1 = quartile(prices, 0.25);
    var q2 = quartile(prices, 0.5);
    var q3 = quartile(prices, 0.75);

    // Calculate needle value based on average minPrice
    var needleValue = averageMinPrice;

    // Update chart data and needle value
    var chart = window.myGauge;
    chart.data.datasets[0].data = [q1, q2, q3, Math.max.apply(null, prices)];
    chart.data.datasets[0].value = needleValue;
    chart.update();

    // Update bar chart data
    updateBarChart(selectedBed);

    // Update pie chart data
    updatePieChart(selectedBed);
            });

    // Quartile calculation function
    function quartile(arr, q) {
                var pos = (arr.length - 1) * q;
    var base = Math.floor(pos);
    var rest = pos - base;
    if (arr[base + 1] !== undefined) {
                    return arr[base] + rest * (arr[base + 1] - arr[base]);
                } else {
                    return arr[base];
                }
            }

    // Gauge chart configuration
    var config = {
        type: 'gauge',
    data: {
        datasets: [{
        data: [0, 0, 0, 0],
    value: 0,
    backgroundColor: ['green', 'yellow', 'orange', 'red'],
    borderWidth: 2
                    }]
                },
    options: {
        responsive: true,
    title: {
        display: true,
    text: 'Distribution of all apartment prices,needle positioned at the average of selected bed & apartment.'
                    },
    layout: {
        padding: {
        bottom: 30
                        }
                    },
    needle: {
        radiusPercentage: 2,
    widthPercentage: 3.2,
    lengthPercentage: 80,
    color: 'rgba(0, 0, 0, 1)'
                    },
    valueLabel: {
        formatter: Math.round
                    }
                }
            };

    // Create gauge chart
    var ctx = document.getElementById('chart').getContext('2d');
    window.myGauge = new Chart(ctx, config);

    // Function to update bar chart data
    function updateBarChart(selectedBed) {
                var selectedBedData = data.filter(function (item) {
                    return item.bed === selectedBed;
                });

    // Create an object to store the average price for each apartment
    var averagePrices = { };

    // Calculate the average price for the selected bed type in each apartment
    selectedBedData.forEach(function (item) {
                    if (!averagePrices[item.apartmentName]) {
        averagePrices[item.apartmentName] = {
            total: item.minPrice,
            count: 1
        };
                    } else {
        averagePrices[item.apartmentName].total += item.minPrice;
    averagePrices[item.apartmentName].count++;
                    }
                });

    // Calculate the average price for each apartment
    var labels = [];
    var prices = [];

    for (var apartmentName in averagePrices) {
                    var averagePrice = averagePrices[apartmentName].total / averagePrices[apartmentName].count;
    labels.push(apartmentName);
    prices.push(Math.round(averagePrice)); // Round the average price to the nearest integer
                }

    var barChart = window.barChart;
    barChart.data.labels = labels;
    barChart.data.datasets[0].data = prices;
    barChart.update();
            }

    // Bar chart configuration
    var barConfig = {
        type: 'bar',
    data: {
        labels: [],
    datasets: [{
        label: 'Average Price',
    backgroundColor: 'rgba(255, 0, 0, 0.5)',
    data: []
                    }]
                },
    options: {
        responsive: true,
    maintainAspectRatio: false, // Add this line
    title: {
        display: true,
    text: 'This bar chart displays the average price of apartments for the selected bed type across different Communities'
                    },
    scales: {
        xAxes: [{
        stacked: true
                        }],
    yAxes: [{
        stacked: true
                        }]
                    }
                }
            };

    // Create bar chart
    var barCtx = document.getElementById('barChart').getContext('2d');
    window.barChart = new Chart(barCtx, barConfig);

    // Function to update pie chart data
    function updatePieChart(selectedBed) {
                var selectedBedData = data.filter(function (item) {
                    return item.bed === selectedBed;
                });

    var apartmentCounts = { };
    selectedBedData.forEach(function (item) {
        apartmentCounts[item.apartmentName] = (apartmentCounts[item.apartmentName] || 0) + 1;
                });

    var pieChart = window.pieChart;
    pieChart.data.labels = Object.keys(apartmentCounts);
    pieChart.data.datasets[0].data = Object.values(apartmentCounts);
    pieChart.update();
            }

    // Pie chart configuration
    var pieConfig = {
        type: 'pie',
    data: {
        labels: [],
    datasets: [{
        data: [],
    backgroundColor: [
    'rgba(255, 99, 132, 0.5)',
    'rgba(54, 162, 235, 0.5)',
    'rgba(255, 206, 86, 0.5)',
    'rgba(75, 192, 192, 0.5)',
    'rgba(153, 102, 255, 0.5)',
    'rgba(255, 159, 64, 0.5)'
    ],
    borderColor: [
    'rgba(255, 99, 132, 1)',
    'rgba(54, 162, 235, 1)',
    'rgba(255, 206, 86, 1)',
    'rgba(75, 192, 192, 1)',
    'rgba(153, 102, 255, 1)',
    'rgba(255, 159, 64, 1)'
    ],
    borderWidth: 1
                    }]
                },
    options: {
        responsive: true,
    title: {
        display: true,
    text: 'Count of selected bed type in different communities'
                    }
                }
            };

    // Create pie chart
    var pieCtx = document.getElementById('pieChart').getContext('2d');
    window.pieChart = new Chart(pieCtx, pieConfig);
